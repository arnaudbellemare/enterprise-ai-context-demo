# Elasticsearch Local Setup (100% Local, No External Connections)

## ✅ Yes, it works completely locally!

Elasticsearch runs entirely on your machine with Docker - no cloud connections, no external services needed.

## Quick Start (Fully Local)

### Step 1: Start Elasticsearch (Docker)

```bash
docker run -d \
  --name elasticsearch \
  -p 9200:9200 \
  -e "discovery.type=single-node" \
  -e "xpack.security.enabled=false" \
  -e "ES_JAVA_OPTS=-Xms512m -Xmx512m" \
  docker.elastic.co/elasticsearch/elasticsearch:9.2.0
```

**That's it!** No passwords, no cloud IDs, no external connections.

### Step 2: Verify it's running

```bash
curl http://localhost:9200
```

You should see:
```json
{
  "name": "...",
  "cluster_name": "docker-cluster",
  "version": {
    "number": "9.2.0"
  }
}
```

### Step 3: Configure PERMUTATION

Add to `frontend/.env.local`:
```env
ELASTICSEARCH_URL=http://localhost:9200
# No username/password needed - security disabled for local dev
```

### Step 4: Test the integration

The code will:
1. ✅ Connect to `localhost:9200` (your Docker container)
2. ✅ Create indices locally
3. ✅ Store/search documents locally
4. ✅ Run entirely on your machine

## What Runs Where

| Component | Location | Notes |
|-----------|----------|-------|
| Elasticsearch | Docker container (localhost:9200) | Your machine only |
| PERMUTATION code | Your machine | Talks to localhost |
| Data/Indices | Inside Docker container | Stored locally |
| Embeddings | Generated by your code | Uses your OpenAI key (if needed) |

**No external Elasticsearch services needed!**

## Persistence (Optional)

If you want data to persist when Docker restarts:

```bash
docker run -d \
  --name elasticsearch \
  -p 9200:9200 \
  -e "discovery.type=single-node" \
  -e "xpack.security.enabled=false" \
  -e "ES_JAVA_OPTS=-Xms512m -Xmx512m" \
  -v elasticsearch-data:/usr/share/elasticsearch/data \
  docker.elastic.co/elasticsearch/elasticsearch:9.2.0
```

The `-v elasticsearch-data:/usr/share/elasticsearch/data` flag creates a Docker volume that persists data.

## Memory Requirements

- Minimum: 512MB RAM (with `-Xms512m -Xmx512m`)
- Recommended: 1GB+ for better performance
- Adjust `ES_JAVA_OPTS` if you have more RAM:
  ```bash
  -e "ES_JAVA_OPTS=-Xms1g -Xmx1g"
  ```

## Graceful Fallback

The code is designed to:
1. Try Elasticsearch first (if available)
2. Fallback to Supabase if Elasticsearch isn't running
3. Never break if Elasticsearch is unavailable

So you can:
- Run with Elasticsearch when you want better search
- Run without it and still use Supabase
- Switch between them seamlessly

## Stopping Elasticsearch

```bash
docker stop elasticsearch
docker rm elasticsearch  # Removes container (data persists if you used -v flag)
```

## Network Isolation

Elasticsearch only listens on `localhost` (127.0.0.1) by default, so:
- ✅ No external connections
- ✅ No internet needed after pulling the image
- ✅ Completely isolated on your machine

## Verification

The code logs will show:
```
✅ Elasticsearch connected: docker-cluster v9.2.0
✅ Expert Trajectories Elasticsearch store initialized
```

If Elasticsearch isn't running, you'll see:
```
⚠️  Elasticsearch not available, will fallback to Supabase
```

And the system continues working with Supabase instead.

## Summary

**Yes, it's 100% local:**
- ✅ No cloud connections
- ✅ No external services
- ✅ Runs entirely in Docker on your machine
- ✅ Data stored locally
- ✅ Works offline (after initial Docker pull)
- ✅ Optional - falls back to Supabase if unavailable

The only external dependency is:
- Docker image download (one time, when you first run `docker run`)
- After that, everything is local!

